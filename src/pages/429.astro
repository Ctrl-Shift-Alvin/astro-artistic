---
import BaseLight from '@/templates/BaseLight.astro';

const translation = Astro.locals.translation;

---

<BaseLight
	head={{
		title: translation.fourTwentyNine.title,
		description: translation.fourTwentyNine.description
	}}
>
	<h1 class="mt-15 w-10/12 text-center text-4xl font-bold">
		{translation.fourTwentyNine.title}
	</h1>

	<p class="newlines mt-3 w-10/12 text-center text-lg">
		{translation.fourTwentyNine.body}
	</p>

	<div
		id="countdown"
		class="mt-5 mx-5 text-xl text-center font-bold"
	/>

	<script is:inline>

		// Make sure loading this page is the right choice
		fetch('/home/') // Small resource
			.then((response) => {

				// If response status is NOT 429, redirect
				if (response.status !== 429) {
					window.location.href = '/';
					return;
				}

				// Fetch retryAfter value
				const countdownElement = document.getElementById('countdown');
				let retryAfterValue = parseInt(window.retryAfter);
				if (retryAfterValue && !isNaN(retryAfterValue) && retryAfterValue > 1) {

					const updateCountdown = () => {

						if (retryAfterValue > 0) {

							countdownElement.textContent =
								window.__TRANSLATION__.fourTwentyNine.reloadIn[0] +
								retryAfterValue.toString() +
								window.__TRANSLATION__.fourTwentyNine.reloadIn[1];
							retryAfterValue--;

						} else {

							countdownElement.textContent = window.__TRANSLATION__.fourTwentyNine.shouldReload;
							window.location.reload();

						}

					};
					updateCountdown();
					setInterval(updateCountdown, 1000);

				} else {

					// Unknown retryAfter value
					countdownElement.textContent = window.__TRANSLATION__.fourTwentyNine.reloadInUnknown;

				}

			});

	</script>
</BaseLight>
